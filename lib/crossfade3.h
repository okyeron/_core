#ifndef CROSSFADE3_LIB
#define CROSSFADE3_COS 0
#define CROSSFADE3_SQRT 1
#define CROSSFADE3_LOG 2
#define CROSSFADE3_LINE 3

static int32_t crossfade3_cos_out[441] = {
    65536, 65535, 65534, 65532, 65529, 65525, 65520, 65515, 65509, 65502, 65494,
    65485, 65475, 65465, 65454, 65442, 65429, 65415, 65400, 65385, 65369, 65351,
    65333, 65315, 65295, 65275, 65253, 65231, 65208, 65185, 65160, 65135, 65108,
    65081, 65053, 65025, 64995, 64965, 64933, 64901, 64868, 64835, 64800, 64765,
    64729, 64692, 64654, 64615, 64576, 64535, 64494, 64452, 64409, 64366, 64321,
    64276, 64230, 64183, 64136, 64087, 64038, 63988, 63937, 63885, 63832, 63779,
    63725, 63670, 63614, 63557, 63500, 63442, 63382, 63323, 63262, 63200, 63138,
    63075, 63011, 62946, 62881, 62815, 62747, 62679, 62611, 62541, 62471, 62400,
    62328, 62255, 62182, 62107, 62032, 61957, 61880, 61802, 61724, 61645, 61565,
    61485, 61403, 61321, 61238, 61155, 61070, 60985, 60899, 60812, 60724, 60636,
    60547, 60457, 60366, 60275, 60183, 60090, 59996, 59901, 59806, 59710, 59613,
    59516, 59417, 59318, 59218, 59118, 59016, 58914, 58811, 58708, 58603, 58498,
    58393, 58286, 58179, 58071, 57962, 57852, 57742, 57631, 57519, 57407, 57293,
    57179, 57065, 56949, 56833, 56716, 56599, 56480, 56361, 56242, 56121, 56000,
    55878, 55756, 55632, 55508, 55383, 55258, 55132, 55005, 54878, 54749, 54620,
    54491, 54360, 54229, 54098, 53965, 53832, 53698, 53564, 53429, 53293, 53156,
    53019, 52881, 52743, 52604, 52464, 52323, 52182, 52040, 51898, 51754, 51611,
    51466, 51321, 51175, 51029, 50881, 50734, 50585, 50436, 50286, 50136, 49985,
    49833, 49681, 49528, 49375, 49221, 49066, 48910, 48754, 48598, 48440, 48283,
    48124, 47965, 47805, 47645, 47484, 47322, 47160, 46997, 46834, 46670, 46506,
    46340, 46175, 46008, 45841, 45674, 45506, 45337, 45168, 44998, 44828, 44657,
    44485, 44313, 44141, 43967, 43794, 43619, 43444, 43269, 43093, 42916, 42739,
    42562, 42384, 42205, 42026, 41846, 41665, 41485, 41303, 41121, 40939, 40756,
    40572, 40388, 40204, 40019, 39833, 39647, 39461, 39274, 39086, 38898, 38710,
    38521, 38331, 38141, 37951, 37760, 37568, 37376, 37184, 36991, 36797, 36604,
    36409, 36215, 36019, 35824, 35628, 35431, 35234, 35036, 34838, 34640, 34441,
    34242, 34042, 33842, 33642, 33441, 33239, 33037, 32835, 32632, 32429, 32226,
    32022, 31817, 31613, 31408, 31202, 30996, 30790, 30583, 30376, 30168, 29960,
    29752, 29544, 29335, 29125, 28915, 28705, 28495, 28284, 28073, 27861, 27649,
    27437, 27224, 27011, 26798, 26584, 26370, 26156, 25941, 25726, 25511, 25295,
    25079, 24863, 24646, 24429, 24212, 23994, 23776, 23558, 23340, 23121, 22902,
    22683, 22463, 22243, 22023, 21802, 21582, 21361, 21139, 20918, 20696, 20474,
    20251, 20029, 19806, 19583, 19359, 19136, 18912, 18687, 18463, 18239, 18014,
    17789, 17563, 17338, 17112, 16886, 16660, 16434, 16207, 15980, 15753, 15526,
    15299, 15071, 14843, 14615, 14387, 14159, 13930, 13701, 13473, 13244, 13014,
    12785, 12555, 12326, 12096, 11866, 11636, 11405, 11175, 10944, 10713, 10483,
    10252, 10020, 9789,  9558,  9326,  9095,  8863,  8631,  8399,  8167,  7935,
    7702,  7470,  7238,  7005,  6772,  6540,  6307,  6074,  5841,  5608,  5375,
    5141,  4908,  4675,  4441,  4208,  3974,  3741,  3507,  3274,  3040,  2806,
    2572,  2339,  2105,  1871,  1637,  1403,  1169,  935,   701,   467,   233,
    0,
};
static int32_t crossfade3_cos_in[441] = {
    0,     233,   467,   701,   935,   1169,  1403,  1637,  1871,  2105,  2339,
    2572,  2806,  3040,  3274,  3507,  3741,  3974,  4208,  4441,  4675,  4908,
    5141,  5375,  5608,  5841,  6074,  6307,  6540,  6772,  7005,  7238,  7470,
    7702,  7935,  8167,  8399,  8631,  8863,  9095,  9326,  9558,  9789,  10020,
    10252, 10483, 10713, 10944, 11175, 11405, 11636, 11866, 12096, 12326, 12555,
    12785, 13014, 13244, 13473, 13701, 13930, 14159, 14387, 14615, 14843, 15071,
    15299, 15526, 15753, 15980, 16207, 16434, 16660, 16886, 17112, 17338, 17563,
    17789, 18014, 18239, 18463, 18687, 18912, 19136, 19359, 19583, 19806, 20029,
    20251, 20474, 20696, 20918, 21139, 21361, 21582, 21802, 22023, 22243, 22463,
    22683, 22902, 23121, 23340, 23558, 23776, 23994, 24212, 24429, 24646, 24863,
    25079, 25295, 25511, 25726, 25941, 26156, 26370, 26584, 26798, 27011, 27224,
    27437, 27649, 27861, 28073, 28284, 28495, 28705, 28915, 29125, 29335, 29544,
    29752, 29960, 30168, 30376, 30583, 30790, 30996, 31202, 31408, 31613, 31817,
    32022, 32226, 32429, 32632, 32835, 33037, 33239, 33441, 33642, 33842, 34042,
    34242, 34441, 34640, 34838, 35036, 35234, 35431, 35628, 35824, 36019, 36215,
    36409, 36604, 36797, 36991, 37184, 37376, 37568, 37760, 37951, 38141, 38331,
    38521, 38710, 38898, 39086, 39274, 39461, 39647, 39833, 40019, 40204, 40388,
    40572, 40756, 40939, 41121, 41303, 41485, 41665, 41846, 42026, 42205, 42384,
    42562, 42739, 42916, 43093, 43269, 43444, 43619, 43794, 43967, 44141, 44313,
    44485, 44657, 44828, 44998, 45168, 45337, 45506, 45674, 45841, 46008, 46175,
    46340, 46506, 46670, 46834, 46997, 47160, 47322, 47484, 47645, 47805, 47965,
    48124, 48283, 48440, 48598, 48754, 48910, 49066, 49221, 49375, 49528, 49681,
    49833, 49985, 50136, 50286, 50436, 50585, 50734, 50881, 51029, 51175, 51321,
    51466, 51611, 51754, 51898, 52040, 52182, 52323, 52464, 52604, 52743, 52881,
    53019, 53156, 53293, 53429, 53564, 53698, 53832, 53965, 54098, 54229, 54360,
    54491, 54620, 54749, 54878, 55005, 55132, 55258, 55383, 55508, 55632, 55756,
    55878, 56000, 56121, 56242, 56361, 56480, 56599, 56716, 56833, 56949, 57065,
    57179, 57293, 57407, 57519, 57631, 57742, 57852, 57962, 58071, 58179, 58286,
    58393, 58498, 58603, 58708, 58811, 58914, 59016, 59118, 59218, 59318, 59417,
    59516, 59613, 59710, 59806, 59901, 59996, 60090, 60183, 60275, 60366, 60457,
    60547, 60636, 60724, 60812, 60899, 60985, 61070, 61155, 61238, 61321, 61403,
    61485, 61565, 61645, 61724, 61802, 61880, 61957, 62032, 62107, 62182, 62255,
    62328, 62400, 62471, 62541, 62611, 62679, 62747, 62815, 62881, 62946, 63011,
    63075, 63138, 63200, 63262, 63323, 63382, 63442, 63500, 63557, 63614, 63670,
    63725, 63779, 63832, 63885, 63937, 63988, 64038, 64087, 64136, 64183, 64230,
    64276, 64321, 64366, 64409, 64452, 64494, 64535, 64576, 64615, 64654, 64692,
    64729, 64765, 64800, 64835, 64868, 64901, 64933, 64965, 64995, 65025, 65053,
    65081, 65108, 65135, 65160, 65185, 65208, 65231, 65253, 65275, 65295, 65315,
    65333, 65351, 65369, 65385, 65400, 65415, 65429, 65442, 65454, 65465, 65475,
    65485, 65494, 65502, 65509, 65515, 65520, 65525, 65529, 65532, 65534, 65535,
    65536,
};
static int32_t crossfade3_sqrt_out[441] = {
    65536, 65461, 65386, 65312, 65237, 65162, 65087, 65012, 64937, 64862, 64786,
    64711, 64636, 64560, 64484, 64409, 64333, 64257, 64181, 64105, 64029, 63952,
    63876, 63800, 63723, 63646, 63570, 63493, 63416, 63339, 63262, 63185, 63107,
    63030, 62953, 62875, 62797, 62720, 62642, 62564, 62486, 62407, 62329, 62251,
    62172, 62094, 62015, 61936, 61858, 61779, 61700, 61620, 61541, 61462, 61382,
    61303, 61223, 61143, 61064, 60984, 60903, 60823, 60743, 60663, 60582, 60501,
    60421, 60340, 60259, 60178, 60097, 60015, 59934, 59853, 59771, 59689, 59607,
    59526, 59443, 59361, 59279, 59197, 59114, 59032, 58949, 58866, 58783, 58700,
    58617, 58533, 58450, 58366, 58283, 58199, 58115, 58031, 57947, 57862, 57778,
    57694, 57609, 57524, 57439, 57354, 57269, 57184, 57098, 57013, 56927, 56841,
    56755, 56669, 56583, 56497, 56410, 56324, 56237, 56150, 56063, 55976, 55889,
    55801, 55714, 55626, 55538, 55450, 55362, 55274, 55186, 55097, 55009, 54920,
    54831, 54742, 54653, 54563, 54474, 54384, 54294, 54204, 54114, 54024, 53933,
    53843, 53752, 53661, 53570, 53479, 53388, 53296, 53205, 53113, 53021, 52929,
    52836, 52744, 52651, 52558, 52466, 52372, 52279, 52186, 52092, 51998, 51904,
    51810, 51716, 51622, 51527, 51432, 51337, 51242, 51147, 51051, 50955, 50860,
    50763, 50667, 50571, 50474, 50377, 50280, 50183, 50086, 49988, 49891, 49793,
    49695, 49596, 49498, 49399, 49300, 49201, 49102, 49002, 48903, 48803, 48703,
    48602, 48502, 48401, 48300, 48199, 48098, 47996, 47894, 47792, 47690, 47588,
    47485, 47382, 47279, 47175, 47072, 46968, 46864, 46760, 46655, 46551, 46446,
    46340, 46235, 46129, 46023, 45917, 45811, 45704, 45597, 45490, 45383, 45275,
    45167, 45059, 44950, 44842, 44733, 44624, 44514, 44404, 44294, 44184, 44073,
    43962, 43851, 43740, 43628, 43516, 43404, 43291, 43178, 43065, 42952, 42838,
    42724, 42609, 42495, 42380, 42264, 42149, 42033, 41916, 41800, 41683, 41566,
    41448, 41330, 41212, 41093, 40974, 40855, 40735, 40615, 40495, 40374, 40253,
    40132, 40010, 39888, 39765, 39643, 39519, 39396, 39271, 39147, 39022, 38897,
    38771, 38645, 38519, 38392, 38264, 38137, 38008, 37880, 37751, 37621, 37491,
    37361, 37230, 37099, 36967, 36835, 36702, 36569, 36435, 36301, 36166, 36031,
    35895, 35759, 35622, 35485, 35347, 35209, 35070, 34930, 34790, 34650, 34509,
    34367, 34225, 34082, 33938, 33794, 33649, 33504, 33358, 33211, 33064, 32916,
    32768, 32618, 32468, 32318, 32166, 32014, 31861, 31708, 31553, 31398, 31243,
    31086, 30929, 30770, 30611, 30451, 30291, 30129, 29967, 29803, 29639, 29474,
    29308, 29141, 28973, 28804, 28634, 28463, 28291, 28118, 27944, 27769, 27593,
    27415, 27237, 27057, 26876, 26694, 26510, 26325, 26139, 25952, 25763, 25573,
    25381, 25188, 24994, 24798, 24600, 24401, 24200, 23998, 23794, 23587, 23380,
    23170, 22958, 22745, 22529, 22312, 22092, 21870, 21645, 21419, 21190, 20958,
    20724, 20487, 20247, 20005, 19759, 19511, 19259, 19004, 18745, 18483, 18217,
    17947, 17673, 17395, 17112, 16824, 16532, 16234, 15930, 15621, 15305, 14983,
    14654, 14317, 13972, 13618, 13255, 12881, 12497, 12100, 11690, 11264, 10822,
    10362, 9879,  9372,  8836,  8266,  7652,  6986,  6248,  5411,  4418,  3124,
    0,
};
static int32_t crossfade3_sqrt_in[441] = {
    0,     3124,  4418,  5411,  6248,  6986,  7652,  8266,  8836,  9372,  9879,
    10362, 10822, 11264, 11690, 12100, 12497, 12881, 13255, 13618, 13972, 14317,
    14654, 14983, 15305, 15621, 15930, 16234, 16532, 16824, 17112, 17395, 17673,
    17947, 18217, 18483, 18745, 19004, 19259, 19511, 19759, 20005, 20247, 20487,
    20724, 20958, 21190, 21419, 21645, 21870, 22092, 22312, 22529, 22745, 22958,
    23170, 23380, 23587, 23794, 23998, 24200, 24401, 24600, 24798, 24994, 25188,
    25381, 25573, 25763, 25952, 26139, 26325, 26510, 26694, 26876, 27057, 27237,
    27415, 27593, 27769, 27944, 28118, 28291, 28463, 28634, 28804, 28973, 29141,
    29308, 29474, 29639, 29803, 29967, 30129, 30291, 30451, 30611, 30770, 30929,
    31086, 31243, 31398, 31553, 31708, 31861, 32014, 32166, 32318, 32468, 32618,
    32768, 32916, 33064, 33211, 33358, 33504, 33649, 33794, 33938, 34082, 34225,
    34367, 34509, 34650, 34790, 34930, 35070, 35209, 35347, 35485, 35622, 35759,
    35895, 36031, 36166, 36301, 36435, 36569, 36702, 36835, 36967, 37099, 37230,
    37361, 37491, 37621, 37751, 37880, 38008, 38137, 38264, 38392, 38519, 38645,
    38771, 38897, 39022, 39147, 39271, 39396, 39519, 39643, 39765, 39888, 40010,
    40132, 40253, 40374, 40495, 40615, 40735, 40855, 40974, 41093, 41212, 41330,
    41448, 41566, 41683, 41800, 41916, 42033, 42149, 42264, 42380, 42495, 42609,
    42724, 42838, 42952, 43065, 43178, 43291, 43404, 43516, 43628, 43740, 43851,
    43962, 44073, 44184, 44294, 44404, 44514, 44624, 44733, 44842, 44950, 45059,
    45167, 45275, 45383, 45490, 45597, 45704, 45811, 45917, 46023, 46129, 46235,
    46340, 46446, 46551, 46655, 46760, 46864, 46968, 47072, 47175, 47279, 47382,
    47485, 47588, 47690, 47792, 47894, 47996, 48098, 48199, 48300, 48401, 48502,
    48602, 48703, 48803, 48903, 49002, 49102, 49201, 49300, 49399, 49498, 49596,
    49695, 49793, 49891, 49988, 50086, 50183, 50280, 50377, 50474, 50571, 50667,
    50763, 50860, 50955, 51051, 51147, 51242, 51337, 51432, 51527, 51622, 51716,
    51810, 51904, 51998, 52092, 52186, 52279, 52372, 52466, 52558, 52651, 52744,
    52836, 52929, 53021, 53113, 53205, 53296, 53388, 53479, 53570, 53661, 53752,
    53843, 53933, 54024, 54114, 54204, 54294, 54384, 54474, 54563, 54653, 54742,
    54831, 54920, 55009, 55097, 55186, 55274, 55362, 55450, 55538, 55626, 55714,
    55801, 55889, 55976, 56063, 56150, 56237, 56324, 56410, 56497, 56583, 56669,
    56755, 56841, 56927, 57013, 57098, 57184, 57269, 57354, 57439, 57524, 57609,
    57694, 57778, 57862, 57947, 58031, 58115, 58199, 58283, 58366, 58450, 58533,
    58617, 58700, 58783, 58866, 58949, 59032, 59114, 59197, 59279, 59361, 59443,
    59526, 59607, 59689, 59771, 59853, 59934, 60015, 60097, 60178, 60259, 60340,
    60421, 60501, 60582, 60663, 60743, 60823, 60903, 60984, 61064, 61143, 61223,
    61303, 61382, 61462, 61541, 61620, 61700, 61779, 61858, 61936, 62015, 62094,
    62172, 62251, 62329, 62407, 62486, 62564, 62642, 62720, 62797, 62875, 62953,
    63030, 63107, 63185, 63262, 63339, 63416, 63493, 63570, 63646, 63723, 63800,
    63876, 63952, 64029, 64105, 64181, 64257, 64333, 64409, 64484, 64560, 64636,
    64711, 64786, 64862, 64937, 65012, 65087, 65162, 65237, 65312, 65386, 65461,
    65536,
};
static int32_t crossfade3_log[441] = {
    65536, 65283, 65031, 64780, 64530, 64282, 64034, 63787, 63541, 63295, 63051,
    62808, 62565, 62324, 62083, 61843, 61604, 61366, 61129, 60893, 60657, 60423,
    60189, 59956, 59724, 59493, 59262, 59032, 58804, 58576, 58348, 58122, 57896,
    57671, 57447, 57223, 57001, 56779, 56558, 56337, 56118, 55899, 55680, 55463,
    55246, 55030, 54815, 54600, 54386, 54173, 53960, 53748, 53537, 53327, 53117,
    52908, 52699, 52491, 52284, 52078, 51872, 51667, 51462, 51258, 51055, 50852,
    50650, 50448, 50248, 50047, 49848, 49649, 49450, 49253, 49055, 48859, 48663,
    48467, 48272, 48078, 47884, 47691, 47499, 47307, 47115, 46924, 46734, 46544,
    46355, 46166, 45978, 45791, 45604, 45417, 45231, 45046, 44861, 44676, 44492,
    44309, 44126, 43944, 43762, 43580, 43399, 43219, 43039, 42860, 42681, 42502,
    42324, 42147, 41970, 41794, 41618, 41442, 41267, 41092, 40918, 40744, 40571,
    40398, 40226, 40054, 39883, 39712, 39541, 39371, 39202, 39032, 38864, 38695,
    38527, 38360, 38193, 38026, 37860, 37694, 37529, 37364, 37200, 37035, 36872,
    36708, 36546, 36383, 36221, 36059, 35898, 35737, 35577, 35416, 35257, 35097,
    34938, 34780, 34622, 34464, 34307, 34149, 33993, 33837, 33681, 33525, 33370,
    33215, 33061, 32907, 32753, 32599, 32446, 32294, 32141, 31990, 31838, 31687,
    31536, 31385, 31235, 31085, 30936, 30787, 30638, 30489, 30341, 30193, 30046,
    29899, 29752, 29605, 29459, 29313, 29168, 29022, 28878, 28733, 28589, 28445,
    28301, 28158, 28015, 27872, 27730, 27588, 27446, 27305, 27163, 27023, 26882,
    26742, 26602, 26462, 26323, 26184, 26045, 25907, 25768, 25631, 25493, 25356,
    25219, 25082, 24946, 24809, 24673, 24538, 24403, 24268, 24133, 23998, 23864,
    23730, 23597, 23463, 23330, 23197, 23065, 22932, 22800, 22668, 22537, 22406,
    22275, 22144, 22014, 21883, 21753, 21624, 21494, 21365, 21236, 21107, 20979,
    20851, 20723, 20595, 20468, 20341, 20214, 20087, 19961, 19834, 19708, 19583,
    19457, 19332, 19207, 19082, 18958, 18834, 18709, 18586, 18462, 18339, 18216,
    18093, 17970, 17848, 17725, 17604, 17482, 17360, 17239, 17118, 16997, 16876,
    16756, 16636, 16516, 16396, 16277, 16157, 16038, 15919, 15801, 15682, 15564,
    15446, 15328, 15211, 15093, 14976, 14859, 14742, 14626, 14510, 14393, 14277,
    14162, 14046, 13931, 13816, 13701, 13586, 13472, 13357, 13243, 13129, 13016,
    12902, 12789, 12676, 12563, 12450, 12337, 12225, 12113, 12001, 11889, 11778,
    11666, 11555, 11444, 11333, 11223, 11112, 11002, 10892, 10782, 10672, 10563,
    10453, 10344, 10235, 10126, 10018, 9909,  9801,  9693,  9585,  9477,  9370,
    9262,  9155,  9048,  8941,  8834,  8728,  8622,  8515,  8409,  8304,  8198,
    8093,  7987,  7882,  7777,  7672,  7568,  7463,  7359,  7255,  7151,  7047,
    6943,  6840,  6737,  6633,  6530,  6428,  6325,  6222,  6120,  6018,  5916,
    5814,  5712,  5611,  5509,  5408,  5307,  5206,  5105,  5005,  4904,  4804,
    4704,  4604,  4504,  4404,  4305,  4205,  4106,  4007,  3908,  3809,  3710,
    3612,  3514,  3415,  3317,  3219,  3122,  3024,  2927,  2829,  2732,  2635,
    2538,  2441,  2345,  2248,  2152,  2056,  1960,  1864,  1768,  1672,  1577,
    1482,  1386,  1291,  1196,  1102,  1007,  912,   818,   724,   630,   536,
    442,
};

int16_t crossfade3_out(int16_t val, uint16_t i, uint8_t crossfade_type) {
  if (crossfade_type == CROSSFADE3_COS) {
    return q16_16_fp_to_int16(
        q16_16_multiply(q16_16_int16_to_fp(val), crossfade3_cos_out[i]));
  } else if (crossfade_type == CROSSFADE3_SQRT) {
    return q16_16_fp_to_int16(
        q16_16_multiply(q16_16_int16_to_fp(val), crossfade3_sqrt_out[i]));
  } else {
    return q16_16_fp_to_int16(
        q16_16_multiply(q16_16_int16_to_fp(val), crossfade3_log[i]));
  }
}
int16_t crossfade3_in(int16_t val, uint16_t i, uint8_t crossfade_type) {
  if (crossfade_type == CROSSFADE3_COS) {
    return q16_16_fp_to_int16(
        q16_16_multiply(q16_16_int16_to_fp(val), crossfade3_cos_in[i]));
  } else if (crossfade_type == CROSSFADE3_SQRT) {
    return q16_16_fp_to_int16(
        q16_16_multiply(q16_16_int16_to_fp(val), crossfade3_sqrt_in[i]));
  } else {
    return q16_16_fp_to_int16(
        q16_16_multiply(q16_16_int16_to_fp(val), 65536 - crossfade3_log[i]));
  }
}
#define CROSSFADE3_LIB 1
#endif
